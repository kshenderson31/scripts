use Net::Whois::ARIN;

our $arin = Net::Whois::ARIN->new(host=>'whois.arin.net', port=>43, timeout=>45);
our %ips;
our %info;
our $circuits=0;

while(<DATA>)
{
	chomp($_);

	our $ip=$_;
	$ip =~ s/^\s+|\s+$//g;
	$ips{$ip}="Yes";
	
	our @result = $arin->query($_);
	our $idx=0;

	foreach(@result)
	{
		$_ =~ s/^\s+|\s+$//g;

		next if length($_) == 0;
		next if substr($_, 0, 1) eq "#";
		next if substr($_, 0, 1) eq ":";
		next if $_ eq " ";

		our($key, $data)=split(":", $_);

		if(defined $data)
		{
			$data =~ s/^\s+|\s+$//g;	
		}
		else
		{
			$idx++;
			$data=$key;
			$key=sprintf("%03d", $idx);
			#print "Key is $key";
		}
		
		$info{"$ip-$key"}=$data;
		#print "|$_|\n" if $ip eq "70.158.102.19";
	}
}

foreach our $key(sort keys %ips)
{
	printf("|%s|%s|%s|%s|%s|\n", $key, $info{"$key-OrgName"}, $info{"$key-City"}, $info{"$key-StateProv"}, $info{"$key-OrgTechPhone"}) if defined $info{"$key-OrgName"};
	printf("|%s|%s|%s|\n", $key, $info{"$key-001"}, $info{"$key-002"}) if defined $info{"$key-001"};
	foreach our $pre(sort keys %info)
	{
		our($k1, undef)=split("-", $pre);
		next if $k1 ne $key;
		#print "$pre:  $info{$pre}\n";
	}
	$circuits++;
}

print "\n\n$circuits circuits processed\n";

exit;

__DATA__
74.188.103.74
68.157.129.242
70.155.115.242
70.158.102.19
74.246.140.242 
66.147.60.226
99.56.225.65
99.191.239.57 
64.252.154.14
68.96.151.83
66.134.86.90
207.148.201.82
24.172.44.66
12.202.164.122
12.202.145.98
64.144.45.34
216.68.146.106
64.144.44.250
68.163.70.67
71.170.50.58
207.28.250.84
12.238.139.34
12.238.139.34
12.238.139.34
68.165.74.178
68.236.219.225
74.0.72.90
173.9.129.129
70.91.234.161
72.149.177.218
67.100.1.122
67.79.83.246
74.247.48.202
69.3.13.66
71.154.61.205
68.93.95.129
99.52.237.1
68.25.89.200
68.213.73.26
74.247.192.90
68.161.235.242
70.107.225.202
184.0.25.84
67.77.44.12
166.148.20.245
208.13.143.236
98.19.106.58
98.19.106.57
71.116.207.66
65.36.48.27
64.218.250.234
69.34.201.8
65.163.59.130
108.64.90.121
69.216.31.145
68.79.137.97
108.178.219.34
97.64.182.172
69.11.139.143
68.157.80.154
70.155.44.242 
68.153.210.82
64.144.39.34
71.242.122.146
65.101.4.33
71.39.70.33
207.148.201.86
71.39.253.226
65.196.126.221
64.233.127.138
68.222.222.10
64.233.127.138
64.222.47.250
24.97.47.130
66.192.167.34
69.33.189.2
69.109.26.209
99.68.118.33
69.109.26.217
69.69.15.24
71.2.224.40
64.192.235.82
65.160.187.6
216.9.107.74
216.9.106.159
166.239.25.155
67.135.118.33
67.135.118.36
67.135.118.40
67.101.181.220
68.167.157.194
99.30.113.185
66.14.182.80
70.91.117.85
70.91.117.81
70.168.68.193
70.182.221.185
216.187.237.157
205.232.71.149
166.143.251.194
24.221.17.237
64.114.6.97
64.114.6.105
142.179.111.25
216.232.84.159
205.200.9.153
205.200.72.6
70.52.235.112
70.50.230.136
